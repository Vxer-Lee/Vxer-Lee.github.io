<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>恶意代码分析实战二：静态分析基础技术 | Lee's Blog</title><meta name="keywords" content="恶意代码分析系列"><meta name="author" content="VxerLee"><meta name="copyright" content="VxerLee"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="我们主要通过以下的四个实验，来学习静态分析的基础技术，请大家务必完成每个实验中题目，这样才能得到有效的水平提升。  实验中的工具或样本都可以在这里下载到：https:&#x2F;&#x2F;github.com&#x2F;Vxer-Lee&#x2F;MalwareAnalysis 实验一：123456789101112131415161718----------------Lab01-01.exeLab01-01.dll------">
<meta property="og:type" content="article">
<meta property="og:title" content="恶意代码分析实战二：静态分析基础技术">
<meta property="og:url" content="https://vxer-lee.github.io/2021/08/09/MalwareAnalysis/2.StaticBasic/index.html">
<meta property="og:site_name" content="Lee&#39;s Blog">
<meta property="og:description" content="我们主要通过以下的四个实验，来学习静态分析的基础技术，请大家务必完成每个实验中题目，这样才能得到有效的水平提升。  实验中的工具或样本都可以在这里下载到：https:&#x2F;&#x2F;github.com&#x2F;Vxer-Lee&#x2F;MalwareAnalysis 实验一：123456789101112131415161718----------------Lab01-01.exeLab01-01.dll------">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vxer-lee.github.io/cover/MalwareAnalysis/2StaticBasic.png">
<meta property="article:published_time" content="2021-08-09T10:02:30.000Z">
<meta property="article:modified_time" content="2021-08-16T11:03:30.000Z">
<meta property="article:author" content="VxerLee">
<meta property="article:tag" content="恶意代码分析系列">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vxer-lee.github.io/cover/MalwareAnalysis/2StaticBasic.png"><link rel="shortcut icon" href="/img/gh0st.ico"><link rel="canonical" href="https://vxer-lee.github.io/2021/08/09/MalwareAnalysis/2.StaticBasic/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '恶意代码分析实战二：静态分析基础技术',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-08-16 19:03:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Lee's Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/lee.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../cover/MalwareAnalysis/2StaticBasic.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Lee's Blog</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">恶意代码分析实战二：静态分析基础技术</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-08-09T10:02:30.000Z" title="发表于 2021-08-09 18:02:30">2021-08-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-08-16T11:03:30.000Z" title="更新于 2021-08-16 19:03:30">2021-08-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/PC%E9%80%86%E5%90%91/">PC逆向</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="恶意代码分析实战二：静态分析基础技术"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer"/> 
我们主要通过以下的四个实验，来学习静态分析的基础技术，请大家务必完成每个实验中题目，这样才能得到有效的水平提升。

<p>实验中的工具或样本都可以在这里下载到：<a target="_blank" rel="noopener" href="https://github.com/Vxer-Lee/MalwareAnalysis">https://github.com/Vxer-Lee/MalwareAnalysis</a></p>
<h2 id="实验一："><a href="#实验一：" class="headerlink" title="实验一："></a>实验一：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">----------------</span><br><span class="line">Lab01-01.exe</span><br><span class="line">Lab01-01.dll</span><br><span class="line">----------------</span><br><span class="line">使用工具：</span><br><span class="line">1. StudyPE+ x86</span><br><span class="line">2. Strings</span><br><span class="line">3. VirSCAN.org</span><br><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;</span><br><span class="line">实验内容：</span><br><span class="line">1、将文件上传到http:&#x2F;&#x2F;www.VirusTotal.com 进行分析并查看报告。文件匹配到了已有的反病毒软件特征吗？</span><br><span class="line">2、这些文件是什么时候编译的？</span><br><span class="line">3、这两个文件中是否存在迹象说明他们是否被加壳或混淆了？如果是，这些迹象在哪里？</span><br><span class="line">4、是否有导入函数显示出了这个恶意代码是做什么的？如果是，是哪些导入函数？</span><br><span class="line">5、是否有任何其他文件或基于主机的迹象，让你可以在受感染系统上查找？</span><br><span class="line">6、是否有基于网络的迹象，可以用来发现受感染机器上的这个恶意代码？</span><br><span class="line">7、你猜这些文件的目的是干什么的？</span><br><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;</span><br></pre></td></tr></table></figure>

<p>实验一主要的目的是让我们通过实践，学习到PE结构分析工具的使用，还有字符串分析工具和在线病毒查杀网站的使用</p>
<h3 id="VirSCAN-org"><a href="#VirSCAN-org" class="headerlink" title="VirSCAN.org"></a>VirSCAN.org</h3><p>实验中的题目1是想让我们将文件上传到VirusTotal.com进行查毒，但是这个网站是国外的并且需要翻墙才能访问，所以我们可以用国内的 <a target="_blank" rel="noopener" href="https://www.virscan.org/">VirSCAN.org</a>来代替。</p>
<p>上传exe后，网站提示文件已经上传过了，那我们直接点查看最后一次的扫描结果即可。</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813163953071-1882133889.png" alt="image-20210812163742357"> </p>
<p>这里可以看到许多杀毒软件报毒了，所以我们可以判定这个文件是属于恶意软件了。</p>
<p>而像有的杀毒软件却没有报毒，出现这种情况应该是该杀毒软件厂商未能收集到样本的特征码并且加入到他的病毒库中，所以他就无法检测到我们的恶意软件。（dll也是通过同样的方式上传即可，这里不在重复演示）</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813163956660-966476172.png" alt="image-20210812164050189"> </p>
<h3 id="查看文件编译时间"><a href="#查看文件编译时间" class="headerlink" title="查看文件编译时间"></a>查看文件编译时间</h3><p>PE文件的编译时间呢，存在PE文件头当中，我们平时做逆向或者恶意代码分析，最好要一张PE结构图来进行查阅。</p>
<p>（仔细看荧光笔的部分，在一个<code>_IMAGE_FILE_HEADER</code>结构体里面就有存放文件编译时间戳的变量<code>TimeDateStamp</code>）</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164016716-1889674843.png" alt="image-20210812164810029"> </p>
<p>我们可以通过像<code>StudyPE+ x86</code>这类PE结构分析软件来查看文件的编译时间，如下图我们通过查看PE头中的文件时间戳，并且计算出时间即可得到文件的编译时间。</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164016860-190726171.png" alt="image-20210812165558881"> </p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164130426-239242223.png" alt="image-20210812165616472"> </p>
<h3 id="StudyPE-x86-查壳"><a href="#StudyPE-x86-查壳" class="headerlink" title="StudyPE+ x86 查壳"></a>StudyPE+ x86 查壳</h3><p>StudyPE中在文件类型这地方会显示壳的特征，而需要注意的是如果程序<code>没有加壳</code>，那么他会直接显示出<code>开发的语言</code>，当然还有第三种情况就是会显示<code>Unknow Exe Type</code>，意思是他无法识别是什么壳或者什么语言开发的。</p>
<p>我们可以看到这里他是显示了<code>E Language -&gt; WuTao</code>，什么意思呢？他这里其实是想告诉我们Lab01-01.exe是用易语言进行开发的，其实呢并不是，易语言他底层其实就是调用VC6++进行编译的，所以这个程序他是用VC6++开发的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">易语言</span><br><span class="line">  |  (底层)</span><br><span class="line">  v</span><br><span class="line"> VC6++</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164020125-81093286.png" alt="image-20210812165946871"> </p>
<h3 id="导入函数"><a href="#导入函数" class="headerlink" title="导入函数"></a>导入函数</h3><p>Lab01-01.exe中引用了两个动态库，而需要注意的是以下4个API函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CreateFileA <span class="comment">//创建文件或打开文件</span></span><br><span class="line">FindNextFileA <span class="comment">//这两个都是用来遍历指定目录所有文件的，特别需要注意因为像勒索软件就需要遍历全盘 对文件进行加密</span></span><br><span class="line">FindFirstFileA</span><br><span class="line">CopyFileA <span class="comment">//拷贝文件，恶意软件往往喜欢将自己拷贝到系统目录。</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164023948-554895898.png" alt="image-20210812171041301"> </p>
<p>在Lab01-01.dll中需要注意的是这三个地方。</p>
<p>其中<code>KERNEL32.dll</code>中的两个API函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;这两个都是互斥量函数，恶意程序往往喜欢创建或打开一个互斥量，因为创建了互斥量后再同一时间只允许一个程序访问其资源。</span><br><span class="line"></span><br><span class="line">CreateMutex <span class="comment">//创建互斥量</span></span><br><span class="line">OpenMutex   <span class="comment">//打开互斥量</span></span><br></pre></td></tr></table></figure>

<p>而这个<code>WS2_32.dll</code>他是一个网络通讯的动态库，所以我们有理由相信这个恶意程序他会有网络通信的操作。</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164028652-578450317.png" alt="image-20210812171918392"> </p>
<h3 id="Strings查看敏感字符串信息"><a href="#Strings查看敏感字符串信息" class="headerlink" title="Strings查看敏感字符串信息"></a>Strings查看敏感字符串信息</h3><p>Strings是微软官方的一个命令行工具，主要用来查看程序中的所有字符串信息，平时我们通过敏感的字符串来定位分析一个程序是极好的选择。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">命令行：</span><br><span class="line">Strings.exe &quot;Lab01-01.exe&quot;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;值得注意的地方有两处</span><br><span class="line">首先第一处他这里不是kernel32.dll而是kerne132.dll是1234的1，</span><br><span class="line">然后第二处是Lab01-01.dll</span><br><span class="line">&#x2F;&#x2F;再结合我们上面分析的导入表，分析出他有个CopyFile的api函数，所以可以得出结论：</span><br><span class="line">这个exe程序想把Lab01-01.dll文件拷贝到系统目录并且伪装成系统文件&quot;kernel32.dll&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164031792-1111504420.png" alt="image-20210812172847905"> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">命令行：</span><br><span class="line">Strings.exe &quot;Lab01-01.dll&quot;</span><br><span class="line"></span><br><span class="line">发现有一个ip地址，&quot;127.26.152.13&quot; 并且结合之前dll的导入函数有网络通讯的动态库。</span><br><span class="line">所以最后的结论是：Lab01-01.exe调用Lab01-01.dll对&quot;127.26.152.13&quot;进行连接，此ip可能是黑客用来控制的主控端ip，程序还会将Lab01-01.dll拷贝到系统目录伪装成&quot;kernel32.dll&quot;，以此达到一个持久化的目的。</span><br></pre></td></tr></table></figure>

<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164034900-2122247722.png" alt="image-20210812173253111"> </p>
<h2 id="实验二："><a href="#实验二：" class="headerlink" title="实验二："></a>实验二：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">----------------</span><br><span class="line">Lab01-02.exe</span><br><span class="line">----------------</span><br><span class="line">使用工具：</span><br><span class="line">1. StudyPE+ x86</span><br><span class="line">2. Strings</span><br><span class="line">3. VirSCAN.org</span><br><span class="line">4. Free UPX</span><br><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;</span><br><span class="line">实验内容：</span><br><span class="line">1、将文件上传到http:&#x2F;&#x2F;www.VirusTotal.com 进行分析并查看报告。文件匹配到了已有的反病毒软件特征吗？</span><br><span class="line">2、是否有这个文件被加壳或混淆的任何迹象？如果是这样，这些迹象是什么？如果该文件被加壳，请进行脱壳。</span><br><span class="line">3、有没有任何导入函数能够暗示出这个程序的功能？如果是，是哪些导入函数，他们会告诉你什么？</span><br><span class="line">4、哪些基于主机或基于网络的迹象可以被用来确定这个恶意代码感染的机器？</span><br><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;</span><br></pre></td></tr></table></figure>

<p><code>实验二主要的学习目的是学会用UPX脱壳</code>，我这里就不再演示题目中的常规操作了，请大家务必都完成这些题目，因为动手实践和反复练习才能让你飞速的涨经验升级，(就像刷无聊的小怪)</p>
<h3 id="UPX-脱壳"><a href="#UPX-脱壳" class="headerlink" title="UPX 脱壳"></a>UPX 脱壳</h3><p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164040500-323976483.png" alt="image-20210812174252256"> </p>
<p>脱壳前：</p>
<p>这里他显示了我们之前说过的<code>Unknow EXE Type</code>，也就是说他无法识别出程序的类型，这里解决的办法是点击深度搜索。</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164041681-1206100825.png" alt="image-20210812174419711"> </p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164044297-855807531.png" alt="image-20210812174545293"> </p>
<p>脱壳后：</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164046240-711895784.png" alt="image-20210812174616454"> </p>
<h2 id="实验三："><a href="#实验三：" class="headerlink" title="实验三："></a>实验三：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">----------------</span><br><span class="line">Lab01-03.exe</span><br><span class="line">----------------</span><br><span class="line">使用工具：</span><br><span class="line">1. StudyPE+ x86</span><br><span class="line">2. Strings</span><br><span class="line">3. VirSCAN.org</span><br><span class="line">4. linxerUnpack</span><br><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;</span><br><span class="line">实验内容：</span><br><span class="line">1、将文件上传到http:&#x2F;&#x2F;www.VirusTotal.com 进行分析并查看报告。文件匹配到了已有的反病毒软件特征吗？</span><br><span class="line">2、是否有这个文件被加壳或混淆的任何迹象？如果是这样，这些迹象是什么？如果该文件被加壳，请进行脱壳。</span><br><span class="line">3、有没有任何导入函数能够暗示出这个程序的功能？如果是，是哪些导入函数，他们会告诉你什么？</span><br><span class="line">4、哪些基于主机或基于网络的迹象可以被用来确定这个恶意代码感染的机器？</span><br><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;</span><br></pre></td></tr></table></figure>

<p><code>实验三的主要学习目的是学会用linxerUnpack进行通用脱壳</code>，还是希望大家将题目都做完，这里就不演示了。</p>
<h3 id="通用脱壳机"><a href="#通用脱壳机" class="headerlink" title="通用脱壳机"></a>通用脱壳机</h3><p>查壳：</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164049720-956519126.png" alt="image-20210812174843358"> </p>
<p>脱壳：</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164052664-407245817.png" alt="image-20210812174944742"> </p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164053166-1137615638.png" alt="image-20210812175011801"> </p>
<h2 id="实验四："><a href="#实验四：" class="headerlink" title="实验四："></a>实验四：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">----------------</span><br><span class="line">Lab01-04.exe</span><br><span class="line">----------------</span><br><span class="line">使用工具：</span><br><span class="line">1. StudyPE+ x86</span><br><span class="line">2. Strings</span><br><span class="line">3. VirSCAN.org</span><br><span class="line">4. Restorator</span><br><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;</span><br><span class="line">实验内容：</span><br><span class="line">1、将文件上传到http:&#x2F;&#x2F;www.VirusTotal.com 进行分析并查看报告。文件匹配到了已有的反病毒软件特征吗？</span><br><span class="line">2、是否有这个文件被加壳或混淆的任何迹象？如果是这样，这些迹象是什么？如果该文件被加壳，请进行脱壳。</span><br><span class="line">3、这个文件是什么时候被编译的？</span><br><span class="line">4、有没有任何导入函数能够暗示出这个程序的功能？如果是，是哪些导入函数，他们会告诉你什么？</span><br><span class="line">5、哪些基于主机或基于网络的迹象可以被用来确定这个恶意代码感染的机器？</span><br><span class="line">6、这个文件在资源段中包含一个资源，使用Restorator工具来检查资源，然后抽取资源。从资源中你能发现什么吗？</span><br><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;</span><br></pre></td></tr></table></figure>

<p><code>实验四的主要学习目的是学会用资源管理器，查看资源</code>，还是希望大家手动将1-6到题目亲手做一遍。</p>
<h3 id="资源查看器"><a href="#资源查看器" class="headerlink" title="资源查看器"></a>资源查看器</h3><p>在Lab01-04中有个”BIN”的资源，并且文件头是以<code>MZ</code>开头，可以确定他是一个PE文件，我们用右键功能将其导出。</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164056184-1521474947.png" alt="image-20210812175358975"> </p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164057602-1335390299.png" alt="image-20210812175545330"> </p>
<p>导出后发现是一个EXE程序，并且没有加壳。</p>
<p>接着我们继续来看看他的导入表，发现他有两个比较可疑的api函数</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164115343-2037423307.png" alt="image-20210812175610925"> </p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164058954-919815121.png" alt="image-20210812175739276"> </p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210813164102403-1446640878.png" alt="image-20210812175805636"> </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WinExec <span class="comment">//这个api主要是用来进行执行程序、命令操作。</span></span><br><span class="line">URLDwonloadToFile <span class="comment">//这个api是从网络上下载文件并保存到本地的一个操作。</span></span><br><span class="line">    </span><br><span class="line">所以请大家自行去完成他会下载一个什么程序 并且执行呢？</span><br></pre></td></tr></table></figure>



<h2 id="最后总结："><a href="#最后总结：" class="headerlink" title="最后总结："></a>最后总结：</h2><p>我们分别学习了以下软件或网站</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://www.virscan.org/">www.virscan.org</a> (查杀恶意软件在线网站)</p>
</li>
<li><p>StudyPE+ x86       (查壳、查看文件编译时间、查看导入表)</p>
</li>
<li><p>Strings.exe            (分析程序中的字符串)</p>
</li>
<li><p>Free UPX                (脱UPX壳)</p>
</li>
<li><p>linxerUnpacker  (脱通用的壳)</p>
</li>
</ul>
<p>欢迎加入QQ群：研究逆向、PWN、WEB安全、物联网安全</p>
<p><img src="https://img2020.cnblogs.com/blog/2080041/202108/2080041-20210816153655993-993042562.png" alt="Pwn菜鸡学习小分队群聊二维码"> </p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97/">恶意代码分析系列</a></div><div class="post_share"><div class="social-share" data-image="/../cover/MalwareAnalysis/2StaticBasic.png" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/08/10/MalwareAnalysis/3.DynamicBasic/"><img class="prev-cover" src="/../cover/MalwareAnalysis/3DynamicBasic.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">恶意代码分析实战三：动态分析基础技术</div></div></a></div><div class="next-post pull-right"><a href="/2021/08/08/MalwareAnalysis/1.Basic/"><img class="next-cover" src="/../cover/MalwareAnalysis/1Basic.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">恶意代码分析实战一：专业术语入门知识</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/08/08/MalwareAnalysis/1.Basic/" title="恶意代码分析实战一：专业术语入门知识"><img class="cover" src="/../cover/MalwareAnalysis/1Basic.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-08</div><div class="title">恶意代码分析实战一：专业术语入门知识</div></div></a></div><div><a href="/2021/08/10/MalwareAnalysis/3.DynamicBasic/" title="恶意代码分析实战三：动态分析基础技术"><img class="cover" src="/../cover/MalwareAnalysis/3DynamicBasic.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-10</div><div class="title">恶意代码分析实战三：动态分析基础技术</div></div></a></div><div><a href="/2021/08/11/MalwareAnalysis/4.IDAPro/" title="恶意代码分析实战四：IDA Pro神器的使用"><img class="cover" src="/../cover/MalwareAnalysis/4IDAPro.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-11</div><div class="title">恶意代码分析实战四：IDA Pro神器的使用</div></div></a></div><div><a href="/2021/08/12/MalwareAnalysis/5.OllyDebug/" title="恶意代码分析实战五：OllyDebug动态结合"><img class="cover" src="/../cover/MalwareAnalysis/5OllyDebug.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-12</div><div class="title">恶意代码分析实战五：OllyDebug动态结合</div></div></a></div><div><a href="/2021/09/07/MalwareAnalysis/6.Panda/" title="恶意代码分析实战六：熊猫烧香病毒分析"><img class="cover" src="/../cover/MalwareAnalysis/6Panda.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-07</div><div class="title">恶意代码分析实战六：熊猫烧香病毒分析</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/lee.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">VxerLee</div><div class="author-info__description">喜欢逆向破解，漏洞挖掘、Web渗透，梦想着成为Mr. Robot</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Vxer-Lee"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/s" target="_blank" title=""><i></i></a><a class="social-icon" href="/e" target="_blank" title=""><i class="1"></i></a><a class="social-icon" href="/a" target="_blank" title=""><i class="2"></i></a><a class="social-icon" href="/r" target="_blank" title=""><i class="3"></i></a><a class="social-icon" href="/c" target="_blank" title=""><i class="4"></i></a><a class="social-icon" href="/h" target="_blank" title=""><i class="5"></i></a><a class="social-icon" href="/" target="_blank" title=""><i class="6"></i></a><a class="social-icon" href="/(" target="_blank" title=""><i class="7"></i></a><a class="social-icon" href="/%E6%90%9C" target="_blank" title=""><i class="8"></i></a><a class="social-icon" href="/%E7%B4%A2" target="_blank" title=""><i class="9"></i></a><a class="social-icon" href="/)" target="_blank" title=""><i class="10"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">喜欢一起研究逆向或者Pwn的可以加QQ群：1145528880</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%B8%80%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">实验一：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VirSCAN-org"><span class="toc-number">1.1.</span> <span class="toc-text">VirSCAN.org</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4"><span class="toc-number">1.2.</span> <span class="toc-text">查看文件编译时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#StudyPE-x86-%E6%9F%A5%E5%A3%B3"><span class="toc-number">1.3.</span> <span class="toc-text">StudyPE+ x86 查壳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.</span> <span class="toc-text">导入函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strings%E6%9F%A5%E7%9C%8B%E6%95%8F%E6%84%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.</span> <span class="toc-text">Strings查看敏感字符串信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BA%8C%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">实验二：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UPX-%E8%84%B1%E5%A3%B3"><span class="toc-number">2.1.</span> <span class="toc-text">UPX 脱壳</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%B8%89%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">实验三：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E8%84%B1%E5%A3%B3%E6%9C%BA"><span class="toc-number">3.1.</span> <span class="toc-text">通用脱壳机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">实验四：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E6%9F%A5%E7%9C%8B%E5%99%A8"><span class="toc-number">4.1.</span> <span class="toc-text">资源查看器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">最后总结：</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By VxerLee</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>